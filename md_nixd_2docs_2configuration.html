<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nixd: Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">nixd
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Configuration</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md6"></a></p>
<p>We support LSP standard <code>workspace/configuration</code> for server configurations.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Default configuration &amp; Who needs configuration</h2>
<p>Most important part of package/options features is the path of "nixpkgs". By default, this is search via standard nix search path. That is, find nixpkgs via <code>&lt;nixpkgs&gt;</code>.</p>
<p>For nix-channels users: nixos option &amp; package features shall work out of box, without any extra effort.</p>
<p>For nix-flake users: (suggestion) you can set $NIX_PATH env to your flake input. e.g.</p>
<div class="fragment"><div class="line">{ inputs, ... }:</div>
<div class="line">{</div>
<div class="line">  # NixOS configuration.</div>
<div class="line">  nix.nixPath = [ &quot;nixpkgs=${inputs.nixpkgs}&quot; ];</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you do not config anything in nixd, here are the defaults (suitable for most nix newbies).</p>
<ul>
<li>nixpkgs packages comes from <code>import &lt;nixpkgs&gt; { }</code></li>
<li>nixos options, evaluated from <code>&lt;nixpkgs&gt;</code></li>
</ul>
<p>For advanced users, e.g. having many custom modules, or want to extend anyother options system, "options" field must be extended in the settings, to tell nixd how to get the modules. tldr:</p>
<ul>
<li>custom module system (home-manager, nix-darwin, flake-parts, ...)</li>
<li>custom nixpkgs path, input from your "system" flake</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Where to place the configuration</h2>
<blockquote class="doxtable">
<p>&zwj;In legacy versions (v1.x), configurations are written in ".nixd.json", please remove them and nixd won't even read such files anymore. </p>
</blockquote>
<p>All configuration should go in <code>nixd</code> section. <code>nixd</code> accept language server protocol specified <code>workspace/configuration</code> to fetch config file. So the location of configuration file basically determined by your editor setup.</p>
<blockquote class="doxtable">
<p>&zwj;Please extend this list for your editor, thanks! </p>
</blockquote>
<details >
<summary >
VSCode</summary>
<p></p>
<p>For vscode users you should write <code>settings.json</code>[^settings] like this:</p>
<p>[^settings]: the file could be applied per-workspace, i.e. <code>.vscode/settings.json</code>, our globally, remotely. VSCode users should familiar with <a href="https://code.visualstudio.com/docs/getstarted/settings">these locations</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;nix.serverSettings&quot;: {</div>
<div class="line">        // settings for &#39;nixd&#39; LSP</div>
<div class="line">        &quot;nixd&quot;: {</div>
<div class="line">            &quot;formatting&quot;: {</div>
<div class="line">                // This is the default if ommited.</div>
<div class="line">                &quot;command&quot;: [ &quot;nixpkgs-fmt&quot; ]</div>
<div class="line">            },</div>
<div class="line">            &quot;options&quot;: {</div>
<div class="line">                // By default, this entriy will be read from `import &lt;nixpkgs&gt; { }`</div>
<div class="line">                // You can write arbitary nix expression here, to produce valid &quot;options&quot; declaration result.</div>
<div class="line">                // Tip: for flake-based configuration, utilize `builtins.getFlake`</div>
<div class="line">                &quot;nixos&quot;: {</div>
<div class="line">                    &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/absolute/path/to/flake\&quot;).nixosConfigurations.&lt;name&gt;.options&quot;</div>
<div class="line">                },</div>
<div class="line">                &quot;home-manager&quot;: {</div>
<div class="line">                    &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/absolute/path/to/flake\&quot;).homeConfigurations.&lt;name&gt;.options&quot;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p></p>
</details>
<details >
<summary >
Neovim</summary>
<p></p>
<p>Configuration via <a href="https://github.com/neovim/nvim-lspconfig">nvim-lspconfig</a> plugin. If you want to make configuration changes based on different projects, you can see nvim-lspconfig official <a href="https://github.com/neovim/nvim-lspconfig/wiki/Project-local-settings">wiki-Project_local_settings</a></p>
<div class="fragment"><div class="line">local nvim_lsp = require(&quot;lspconfig&quot;)</div>
<div class="line">nvim_lsp.nixd.setup({</div>
<div class="line">   cmd = { &quot;nixd&quot; },</div>
<div class="line">   settings = {</div>
<div class="line">      nixd = {</div>
<div class="line">         nixpkgs = {</div>
<div class="line">            expr = &quot;import &lt;nixpkgs&gt; { }&quot;,</div>
<div class="line">         },</div>
<div class="line">         formatting = {</div>
<div class="line">            command = { &quot;nixpkgs-fmt&quot; },</div>
<div class="line">         },</div>
<div class="line">         options = {</div>
<div class="line">            nixos = {</div>
<div class="line">               expr = &#39;(builtins.getFlake (&quot;git+file://&quot; + toString ./.)).nixosConfigurations.k-on.options&#39;,</div>
<div class="line">            },</div>
<div class="line">            home_manager = {</div>
<div class="line">               expr = &#39;(builtins.getFlake (&quot;git+file://&quot; + toString ./.)).homeConfigurations.&quot;ruixi@k-on&quot;.options&#39;,</div>
<div class="line">            },</div>
<div class="line">         },</div>
<div class="line">      },</div>
<div class="line">   },</div>
<div class="line">})</div>
</div><!-- fragment --> </details>
<h2><a class="anchor" id="autotoc_md9"></a>
Configuration overview</h2>
<blockquote class="doxtable">
<p>&zwj;[!NOTE] This annotated json are under the key "nixd". If you don't know what does exactly this mean please see editor examples above. </p>
</blockquote>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;nixpkgs&quot;: {</div>
<div class="line">    // For flake.</div>
<div class="line">    // &quot;expr&quot;: &quot;import (builtins.getFlake \&quot;/home/lyc/workspace/CS/OS/NixOS/flakes\&quot;).inputs.nixpkgs { }   &quot;</div>
<div class="line"> </div>
<div class="line">    // This expression will be interpreted as &quot;nixpkgs&quot; toplevel</div>
<div class="line">    // Nixd provides package, lib completion/information from it.</div>
<div class="line">    ///</div>
<div class="line">    // Resouces Usage: Entries are lazily evaluated, entire nixpkgs takes 200~300MB for just &quot;names&quot;.</div>
<div class="line">    ///                Package documentation, versions, are evaluated by-need.</div>
<div class="line">    &quot;expr&quot;: &quot;import &lt;nixpkgs&gt; { }&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;formatting&quot;: {</div>
<div class="line">    // Which command you would like to do formatting</div>
<div class="line">    &quot;command&quot;: [ &quot;nixpkgs-fmt&quot; ]</div>
<div class="line">  },</div>
<div class="line">  // Tell the language server your desired option set, for completion</div>
<div class="line">  // This is lazily evaluated.</div>
<div class="line">  &quot;options&quot;: { // Map of eval information</div>
<div class="line">    // If this is ommited, default search path (&lt;nixpkgs&gt;) will be used.</div>
<div class="line">    &quot;nixos&quot;: { // This name &quot;nixos&quot; could be arbitary.</div>
<div class="line">      // The expression to eval, intepret it as option declarations.</div>
<div class="line">      &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/home/lyc/flakes\&quot;).nixosConfigurations.adrastea.options&quot;</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    // By default there is no home-manager options completion, thus you can add this entry.</div>
<div class="line">    &quot;home-manager&quot;: {</div>
<div class="line">      &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/home/lyc/flakes\&quot;).homeConfigurations.\&quot;lyc@adrastea\&quot;.options&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Fields explanation</h2>
<h3><a class="anchor" id="autotoc_md11"></a>
Format ("formating")</h3>
<p>To configure which command will be used for formatting, you can change the "formatting" section.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;formatting&quot;: {</div>
<div class="line">    // The external command to be invoked for formatting</div>
<div class="line">    &quot;command&quot;: [ &quot;some-command&quot; ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
Options ("options")</h3>
<p>This is our support for nixpkgs option system.</p>
<p>Generally options are merged under a special attribute path. For example, NixOS options could be found at:</p>
<div class="fragment"><div class="line">&lt;flakeref&gt;#nixosConfigurations.&lt;name&gt;.options</div>
</div><!-- fragment --><p>And, home-manager options also could be found at:</p>
<div class="fragment"><div class="line">&lt;flakeref&gt;#homeConfigurations.&lt;name&gt;.options</div>
</div><!-- fragment --><p>In our option system, you need to specify which option set you'd like to use.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  // Tell the language server your desired option set, for completion</div>
<div class="line">  // This is lazily evaluated.</div>
<div class="line">  &quot;options&quot;: { // Map of eval information</div>
<div class="line">    // If this is ommited, default search path (&lt;nixpkgs&gt;) will be used.</div>
<div class="line">    &quot;nixos&quot;: { // This name &quot;nixos&quot; could be arbitary.</div>
<div class="line">      // The expression to eval, intepret it as option declarations.</div>
<div class="line">      &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/home/lyc/flakes\&quot;).nixosConfigurations.adrastea.options&quot;</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    // By default there is no home-manager options completion, thus you can add this entry.</div>
<div class="line">    &quot;home-manager&quot;: {</div>
<div class="line">      &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/home/lyc/flakes\&quot;).homeConfigurations.\&quot;lyc@adrastea\&quot;.options&quot;</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    // For flake-parts opitons.</div>
<div class="line">    // Firstly read the docs here to enable &quot;debugging&quot;, exposing declarations for nixd.</div>
<div class="line">    // https://flake.parts/debug</div>
<div class="line">    &quot;flake-parts&quot;: {</div>
<div class="line">      &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/path/to/your/flake\&quot;).debug.options&quot;</div>
<div class="line">    },</div>
<div class="line">    // For a `perSystem` flake-parts option:</div>
<div class="line">    &quot;flake-parts2&quot;: {</div>
<div class="line">      &quot;expr&quot;: &quot;(builtins.getFlake \&quot;/path/to/your/flake\&quot;).currentSystem.options&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
